---
title: Dockerfile-Docker 镜像原理
date: 2023-08-20 10:27:41
permalink: /pages/a5b8db/
categories:
  - CloudNative
tags:
  - 
---
# Docker 镜像原理
**   操作系统组成部分：**

- 进程调度子系统
- 进程通信子系统
- 内存管理子系统
- 设备管理子系统
- 文件管理子系统
- 网络通信子系统
- 作业控制子系统

Linux文件系统由bootfs和rootfs两部分组成 

- bootfs：包含bootloader（引导加载程序）和 kernel（内核）
- rootfs： root文件系统，包含的就是典型 Linux 系统中的/dev，/proc，/bin，/etc等标准目录和文件
- 不同的linux发行版，bootfs基本一样，而rootfs不同，如ubuntu，centos等

![image.png](https://cdn.nlark.com/yuque/0/2022/png/2659116/1647762863138-a3f7943f-3e10-4f8b-8ede-c24f60877730.png#clientId=u417f972f-bc22-4&from=paste&height=100&id=ua2c4ac7f&originHeight=133&originWidth=332&originalType=binary&ratio=1&rotation=0&showTitle=false&size=11355&status=done&style=none&taskId=u142374a8-fbca-424d-b2aa-54d4cd0da3c&title=&width=248.99999257922195)

- Docker镜像是由特殊的文件系统叠加而成最底端是 bootfs，并使用宿主机的bootfs 
- 第二层是 root文件系统rootfs,称为base image然后再往上可以叠加其他的镜像文件
- 统一文件系统（Union File System）技术能够将不同的层整合成一个文件系统，为这些层提供了一个统一的视角，这样就隐藏了多层的存在，在用户的角度看来，只存在一个文件系统。 
- 一个镜像可以放在另一个镜像的上面。位于下面的镜像称为父镜像，最底部的镜像成为基础镜像。
- 当从一个镜像启动容器时，Docker会在最顶层加载一个读写文件系统作为容器

![image.png](https://cdn.nlark.com/yuque/0/2022/png/2659116/1647763017333-a09fadce-66d2-4dba-9940-26073eeadde1.png#clientId=u417f972f-bc22-4&from=paste&height=289&id=uaf7b5da4&originHeight=385&originWidth=736&originalType=binary&ratio=1&rotation=0&showTitle=false&size=150100&status=done&style=none&taskId=ubef50904-ff7b-4404-aabf-7273bae9eb0&title=&width=551.9999835491185)
# 问题
**Docker 镜像本质是什么？**
   是一个分层文件系统
**Docker 中一个centos镜像为什么只有200MB，而一个centos操作系统的iso文件要几个个G？**
   Centos的iso镜像文件包含bootfs和rootfs，而docker的centos镜像复用操作系统的bootfs，只有rootfs和其他镜像层
**Docker 中一个tomcat镜像为什么有500MB，而一个tomcat安装包只有70多MB？**
   由于docker中镜像是分层的，tomcat虽然只有70多MB，但他需要依赖于父镜像和基础镜像，所有整个对外暴露的tomcat镜像大小500多MB
